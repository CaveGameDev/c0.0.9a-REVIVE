<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft (CheerPJ)</title>
    <style>
        /* Essential styles for fullscreen rendering */
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
            background-color: #000;
        }
        #game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>
    <script src="https://cjrtnc.leaningtech.com/4.0/loader.js"></script>
</head>
<body>

    <div id="game-container">
        <canvas id="minecraft-canvas"></canvas> 
    </div>

    <script type="module">
        // Ensure the DOM is fully loaded before trying to access elements or initialize CheerPJ.
        document.addEventListener('DOMContentLoaded', async () => {
            // Tell LWJGL (through CheerPJ) which HTML canvas element to use for rendering.
            window.lwjglCanvasElement = document.getElementById('minecraft-canvas');

            // Initialize CheerPJ with debugging enabled and necessary Java properties.
            await cheerpjInit({
                enableDebug: true,
                // These are Java System Properties, passed to the JVM itself.
                javaProperties: [
                    "java.library.path=/app/client", // Path where native libs are extracted by CheerpJ
                    "sun.java2d.nodraw=true",
                    "sun.awt.noerasebackground=true",
                    "sun.java2d.d3d=false",
                    "sun.java2d.opengl=false"
                ] 
            });

            // Define the classpath for Minecraft and all its dependencies.
            // NOW LOADING REGULAR .JAR FILES, bypassing .LZMA decompression.
            // IMPORTANT: Ensure these .jar files are uploaded to your /client/ directory!
            const classPath = [
                "/app/client/minecraft.jar",           // THIS IS THE MAIN GAME JAR (contains com.mojang.minecraft.Minecraft)
                // Removed lzma.jar as we're no longer using .lzma compressed files
                "/app/client/windows_natives.jar",     // LWJGL Native libraries (load BEFORE lwjgl.jar)
                "/app/client/lwjgl.jar",               // Core LWJGL JAR
                "/app/client/jinput.jar",              // JInput for input handling
                // REMOVED: lwjgl_util.jar as requested.
                "/app/client/res.jar"                  // Resource JAR, if your Minecraft version uses it
            ].join(':'); 

            console.log("CheerpJ runtime initialized. Attempting to start Minecraft...");
            
            // Define different sets of command-line arguments to try
            const launchAttempts = [
                { 
                    name: "Attempt 1: Standard Width/Height", 
                    args: ["-width", "854", "-height", "480"] 
                },
                { 
                    name: "Attempt 2: Width/Height with Default Username (e.g., for offline play)", 
                    args: ["DefaultPlayer", "-width", "854", "-height", "480"] 
                },
                { 
                    name: "Attempt 3: Width/Height with Username & Session ID", 
                    args: ["DefaultPlayer", "-sessionid", "CJP_Session12345", "-width", "854", "-height", "480"] 
                },
                { 
                    name: "Attempt 4: Fullscreen with Username & Session ID", 
                    args: ["DefaultPlayer", "-sessionid", "CJP_Session12345", "-fullscreen"] 
                }
            ];

            let success = false;
            let lastError = null;

            for (let i = 0; i < launchAttempts.length; i++) {
                const attempt = launchAttempts[i];
                console.log(`\n--- ${attempt.name} (${i + 1}/${launchAttempts.length}) ---`);
                
                try {
                    const exitCode = await cheerpjRunMain(
                        "com.mojang.minecraft.Minecraft", 
                        classPath,
                        ...attempt.args
                    );
                    console.log(`Minecraft exited with code: ${exitCode}`);
                    success = true;
                    break; 
                } catch (e) {
                    console.error(`Attempt ${i + 1} failed:`, e);
                    lastError = e;
                    if (e instanceof Error && e.message.includes("com.mojang.minecraft.Minecraft")) {
                        console.warn("Main Minecraft class not found. This indicates a critical classpath or file integrity issue.");
                    } else if (e instanceof Error && e.message.includes("LWJGLException")) {
                        console.warn("LWJGL error encountered. Ensure LWJGL JARs and native libraries are correct and loaded.");
                    } else if (e instanceof Error && e.message.includes("error in opening zip file")) {
                        console.warn("Error opening JAR file. This often means the JAR is corrupted or incomplete.");
                    }
                }
            }

            if (!success) {
                console.error("All launch attempts failed to start Minecraft.");
                alert(`Failed to start Minecraft after multiple attempts. Last error: ${lastError ? lastError.message : "Unknown error"}. Please check the browser console for more details.`);
            }
        });
    </script>

</body>
</html>
