<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft (CheerPJ)</title>
    <style>
        /* Essential styles for fullscreen rendering */
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
            background-color: #000;
        }
        #game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>
    <script src="https://cjrtnc.leaningtech.com/4.0/loader.js"></script>
</head>
<body>

    <div id="game-container">
        <canvas id="minecraft-canvas"></canvas> 
    </div>

    <script type="module">
        // Ensure the DOM is fully loaded before trying to access elements or initialize CheerPJ.
        document.addEventListener('DOMContentLoaded', async () => {
            // Tell LWJGL (through CheerPJ) which HTML canvas element to use for rendering.
            window.lwjglCanvasElement = document.getElementById('minecraft-canvas');

            // Initialize CheerPJ with debugging enabled and necessary Java properties.
            await cheerpjInit({
                enableDebug: true,
                // These are Java System Properties, passed to the JVM itself.
                javaProperties: [
                    "java.library.path=/app/client", // Path where native libs are extracted by CheerpJ
                    "sun.java2d.nodraw=true",
                    "sun.awt.noerasebackground=true",
                    "sun.java2d.d3d=false",
                    "sun.java2d.opengl=false"
                ] 
            });

            // Define the classpath for Minecraft and all its dependencies.
            // Critical Order: minecraft.jar -> lzma.jar -> natives JAR -> LWJGL JARs.
            const classPath = [
                "/app/client/minecraft.jar",           // THIS IS THE MAIN GAME JAR (contains com.mojang.minecraft.Minecraft)
                "/app/client/lzma.jar",                // Required by CheerpJ for .lzma decompression
                "/app/client/windows_natives.jar.lzma",// **MOVED**: LWJGL Native libraries (load BEFORE lwjgl.jar)
                "/app/client/lwjgl.jar.pack.lzma",     // Core LWJGL JAR
                "/app/client/jinput.jar.pack.lzma",    // JInput for input handling
                "/app/client/lwjgl_util.jar.pack.lzma",// LWJGL utility JAR
                "/app/client/res.jar.lzma"             // Resource JAR, if your Minecraft version uses it
            ].join(':'); 

            console.log("CheerpJ runtime initialized. Attempting to start Minecraft...");
            
            // Define different sets of command-line arguments to try
            const launchAttempts = [
                { 
                    name: "Attempt 1: Standard Width/Height", 
                    args: ["-width", "854", "-height", "480"] 
                },
                { 
                    name: "Attempt 2: Width/Height with Default Username (e.g., for offline play)", 
                    args: ["DefaultPlayer", "-width", "854", "-height", "480"] 
                },
                { 
                    name: "Attempt 3: Width/Height with Username & Session ID", 
                    // Session ID is often needed for offline mode in some versions. Can be any unique string.
                    args: ["DefaultPlayer", "-sessionid", "CJP_Session12345", "-width", "854", "-height", "480"] 
                },
                { 
                    name: "Attempt 4: Fullscreen with Username & Session ID", 
                    // Some versions might prefer fullscreen. This combines the most common arguments.
                    args: ["DefaultPlayer", "-sessionid", "CJP_Session12345", "-fullscreen"] 
                }
                // Add more specific argument sets here if you learn more about your Minecraft version's needs:
                // { name: "Attempt 5: Custom Game Directory", args: ["--gameDir", "/app/minecraft_data", "-width", "854", "-height", "480"] }
            ];

            let success = false;
            let lastError = null;

            for (let i = 0; i < launchAttempts.length; i++) {
                const attempt = launchAttempts[i];
                console.log(`\n--- ${attempt.name} (${i + 1}/${launchAttempts.length}) ---`);
                
                try {
                    // Execute the main class, 'com.mojang.minecraft.Minecraft', from the loaded JARs.
                    const exitCode = await cheerpjRunMain(
                        "com.mojang.minecraft.Minecraft", 
                        classPath,
                        ...attempt.args
                    );
                    console.log(`Minecraft exited with code: ${exitCode}`);
                    success = true;
                    break; // Exit loop if successful
                } catch (e) {
                    console.error(`Attempt ${i + 1} failed:`, e);
                    lastError = e;
                    // If it's a ClassNotFoundException for the main class, it's a critical path issue
                    // which might not be resolved by different args, but we'll still try other args.
                    if (e instanceof Error && e.message.includes("com.mojang.minecraft.Minecraft")) {
                        console.warn("Main Minecraft class not found. Check classpath and file integrity.");
                    } else if (e instanceof Error && e.message.includes("LWJGLException")) {
                        console.warn("LWJGL error encountered. Check native JARs and java.library.path.");
                    }
                    // Continue to next attempt
                }
            }

            if (!success) {
                console.error("All launch attempts failed to start Minecraft.");
                alert(`Failed to start Minecraft after multiple attempts. Last error: ${lastError ? lastError.message : "Unknown error"}. Please check the browser console for more details.`);
            }
        });
    </script>

</body>
</html>
