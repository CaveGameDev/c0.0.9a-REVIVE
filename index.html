<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft (CheerPJ) - Classic Attempt</title>
    <style>
        /* Essential styles for fullscreen rendering */
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
            background-color: #000;
        }
        #game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>
    <script src="https://cjrtnc.leaningtech.com/4.0/loader.js"></script>
</head>
<body>

    <div id="game-container">
        <canvas id="minecraft-canvas"></canvas> 
    </div>

    <script type="module">
        document.addEventListener('DOMContentLoaded', async () => {
            window.lwjglCanvasElement = document.getElementById('minecraft-canvas');

            await cheerpjInit({
                enableDebug: true, // Keep debug enabled for now for easier troubleshooting
                javaProperties: [
                    "java.library.path=/app/client", // Path where native libs are extracted by CheerpJ
                    "sun.java2d.nodraw=true",
                    "sun.awt.noerasebackground=true",
                    "sun.java2d.d3d=false",
                    "sun.java2d.opengl=false",
                    "-Djava.security.policy=/app/client/game.policy" 
                ] 
            });

            // Define the classpath for Minecraft and all its dependencies.
            // Using your newly signed 'my_classic_minecraft.jar'
            // We are attempting a DIRECT launch of Minecraft's main class first.
            const classPath = [
                "/app/client/my_classic_minecraft.jar", // <--- Your newly created and signed JAR
                // Commenting out LaunchWrapper and jopt-simple for direct launch attempt:
                // "/app/client/launchwrapper.jar",       
                // "/app/client/jopt-simple-4.5.jar",
                // Ensure these other JARs are also uploaded to /client/ and are correctly signed if they have old signatures:
                "/app/client/windows_natives.jar",     
                "/app/client/lwjgl.jar",               
                "/app/client/jinput.jar",              
                "/app/client/res.jar"                  
            ].join(':'); 

            console.log("CheerPJ runtime initialized. Attempting to start classic Minecraft directly...");
            
            try {
                // Attempting direct launch of com.mojang.minecraft.Minecraft
                // If this doesn't work, we might need to revert to using LaunchWrapper
                // if AlphaVanillaTweaker is essential for this specific version.
                const exitCode = await cheerpjRunMain(
                    "com.mojang.minecraft.Minecraft", // Direct main class for very old Minecraft
                    classPath,
                    // No arguments needed for initial direct launch of very early Minecraft
                    // If the game expects specific args (e.g., username), they would go here:
                    // "-username", "Player"
                );
                console.log(`Minecraft exited with code: ${exitCode}`);
            } catch (e) {
                console.error("Failed to start Minecraft directly:", e);
                alert(`Failed to start Minecraft. Please check the browser console for more details.`);
                // You can add more specific error handling here if desired.
                if (e instanceof Error && e.message.includes("ClassNotFoundException")) {
                    console.warn("A class was not found. Check your classPath for missing or incorrectly named JARs.");
                } else if (e instanceof Error && e.message.includes("NoSuchMethodError")) {
                    console.warn("Method not found. Might be a version incompatibility between Java libraries.");
                }
            }
        });
    </script>

</body>
</html>
